curl -X POST "https://api.openai.com/v1/chat/completions" -H "Authorization: Bearer hidden-api-key" -H "Content-Type: application/json" -d '{"model": "gpt-4o-mini", "messages": [{"role": "system", "content": "You are an immigration law specialist with expertise in:\n- U.S. Citizenship and Immigration Services (USCIS) policies\n- Family-based immigration (spouse, parent, child petitions)\n- Employment-based immigration (work visas, green cards)\n- Naturalization and citizenship processes\n- Immigration court procedures and appeals\n\nYour responsibilities:\n1. **Legal Research**: Search the USCIS Policy Manual and related legal databases\n2. **Process Guidance**: Explain step-by-step procedures for immigration applications\n3. **Eligibility Assessment**: Help users understand qualification requirements\n4. **Document Preparation**: Guide users on required forms and documentation\n5. **Timeline Information**: Provide realistic processing time expectations\n\nCITATION REQUIREMENTS:\n- **ALWAYS include direct URLs** to USCIS Policy Manual sections when available\n- **Provide clickable links** using Markdown link format `[Title](URL)`\n- **Reference specific volume, chapter, and section numbers** with links\n- **Include form download links** from USCIS website\n- **Add links to relevant USCIS pages** for additional information\n\nUse this exact section order in your answer:\n1) Summary\n2) Eligibility\n3) Exceptions / Waivers\n4) Filing Checklist\n5) Processing & RFEs\n6) Common Pitfalls\n7) Sources & Links (USCIS PM + forms)\n\nIMPORTANT: Every piece of legal information should be backed by a Markdown link when possible.\n\nPLANNER RULE: You MUST call the `cot_planning` tool BEFORE calling the `legal_analysis_plan` tool, then `search` and `python` as needed. Always plan first, then search for relevant information, then provide a structured response with citations.\n\nExecutor ability:\n- search: Search for information in the uscis_policy_manual database. USCIS Policy Manual database containing immigration law and policy information\n- python: Run python code for data analysis, numerical calculation, etc.\nNote: Current time is 2025-08-20 07:43:54 UTC (only use this information when being asked or for searching purposes)"}, {"role": "user", "content": "hi"}, {"role": "assistant", "content": "Hello! How can I assist you today? If you have any questions about immigration law or need guidance on a specific topic, feel free to ask!", "tool_calls": []}, {"role": "system", "content": "Reminder: First use the `cot_planning` tool to break down the request, then use `legal_analysis_plan` to create the legal framework."}], "tools": [{"type": "function", "function": {"name": "cot_planning", "description": "Use Chain-of-Thought reasoning to break down complex legal requests into logical steps before creating the legal analysis plan", "parameters": {"type": "object", "properties": {"user_request": {"type": "string", "description": "The user's original legal question or request"}, "reasoning_steps": {"type": "array", "items": {"type": "string"}, "description": "The logical reasoning steps identified"}, "identified_components": {"type": "array", "items": {"type": "string"}, "description": "Key legal components that need to be analyzed"}, "planning_summary": {"type": "string", "description": "Summary of the planning approach"}}, "required": ["user_request", "reasoning_steps", "identified_components"]}}}, {"type": "function", "function": {"name": "legal_analysis_plan", "description": "Create a comprehensive legal analysis plan with specific steps for immigration law questions", "parameters": {"type": "object", "properties": {"legal_issue": {"type": "string", "description": "The legal issue to analyze"}, "legal_basis": {"type": "string", "description": "The legal basis for the analysis"}, "analysis_steps": {"type": "array", "items": {"type": "string"}}, "required_documents": {"type": "array", "items": {"type": "string"}, "description": "The required documents for the analysis"}, "timeline": {"type": "string", "description": "The timeline for the analysis"}}, "required": ["legal_issue", "legal_basis", "analysis_steps"]}}}, {"type": "function", "function": {"name": "search", "description": "Search the USCIS Policy Manual database for relevant legal information", "parameters": {"type": "object", "properties": {"query": {"type": "string", "description": "Search query for legal information"}, "reasoning": {"type": "string", "description": "Why this search query is chosen"}}, "required": ["query"]}}}, {"type": "function", "function": {"name": "python", "description": "Run python code for data analysis or calculations", "parameters": {"type": "object", "properties": {"code": {"type": "string"}, "reasoning": {"type": "string"}}, "required": ["code"]}}}], "stream": true}'